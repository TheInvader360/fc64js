<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>loop-with-fps</title>
    <script>
      let canvas;
      let canvasCtx;
      let fps;
      let lastFrameAt = performance.now();

      window.addEventListener('load', init);

      function init() {
        canvas = document.createElement('canvas');
        canvas.width = 64;
        canvas.height = 64;
        canvasCtx = canvas.getContext('2d');
        document.body.appendChild(canvas);
        window.requestAnimationFrame(mainLoop);
      }

      function mainLoop(now) {
        if (now - lastFrameAt > 1000/61) { // throttle frame rate to max 60fps
          const secondsSinceLastFrame = (now - lastFrameAt) / 1000;
          lastFrameAt = now;
          fps = Math.round(1 / secondsSinceLastFrame);
          canvasCtx.fillStyle = Math.random() > 0.5 ? '#ff0000' : '#0000ff';
          canvasCtx.fillRect(0, 0, 200, 200);
          canvasCtx.font = '20px Arial';
          canvasCtx.fillStyle = '#ffffff';
          canvasCtx.fillText(`${fps}fps`, 0, 40);
        }
        window.requestAnimationFrame(mainLoop); // keep requesting new frames
      }
    </script>
  </head>
  <body>
  </body>
</html>
